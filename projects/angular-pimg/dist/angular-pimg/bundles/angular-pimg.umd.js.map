{"version":3,"file":"angular-pimg.umd.js.map","sources":["ng://angular-pimg/lib/angular-pimg.service.ts","ng://angular-pimg/lib/angular-pimg.component.ts","ng://angular-pimg/lib/angular-pimg.module.ts"],"sourcesContent":["import { Injectable, Optional, Inject } from '@angular/core';\nimport { AngularPimgOptions } from './config-options';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class AngularPimgService {\n  private _className: string;\n  private _placeholderClassName = 'pimg__placeholder';\n  private _fetchOnDemand = false;\n  private _dataSaver: boolean;\n  private _buttonClassName = 'pimg_btn';\n  private _wrapperClassName = 'pimg_wrapper';\n\n  constructor(@Optional() @Inject('Options') options: AngularPimgOptions) {\n    if (options) {\n      this.setConfig(options);\n    }\n  }\n\n  get wrapperClassName(): string {\n    return this._wrapperClassName;\n  }\n\n  get buttonClassName(): string {\n    return this._buttonClassName;\n  }\n\n  get className(): string {\n    return this._className;\n  }\n\n  get placeholderClassName(): string {\n    return this._placeholderClassName;\n  }\n\n  get dataSaver(): boolean {\n    return this._dataSaver;\n  }\n\n  get fetchOnDemand(): boolean {\n    return this._fetchOnDemand;\n  }\n\n  setConfig({ className, dataSaver, fetchOnDemand, placeholderClassName }: Partial<AngularPimgOptions>) {\n    this._className = typeof className !== 'undefined' ? className : this.className;\n    this._fetchOnDemand = typeof fetchOnDemand !== 'undefined' ? fetchOnDemand : this.fetchOnDemand;\n    this._placeholderClassName = typeof placeholderClassName !== 'undefined' ? placeholderClassName : this.placeholderClassName;\n    if (typeof dataSaver === 'undefined') {\n      return;\n    }\n    if (typeof dataSaver === 'object') {\n      this._buttonClassName = dataSaver.buttonClassName;\n      this._wrapperClassName = dataSaver.wrapperClassName;\n    } else {\n      this._dataSaver = true; // dataSaver is true\n    }\n  }\n\n}\n","import { Component, Input, Output, EventEmitter, SimpleChanges, OnChanges, ElementRef } from '@angular/core';\nimport { DomSanitizer, SafeUrl } from '@angular/platform-browser';\nimport { AngularPimgService } from './angular-pimg.service';\nimport { AngularPimgOptions } from './config-options';\n\n@Component({\n  selector: 'angular-pimg',\n  template: `<div [ngClass]=\"wrapperClassName\" *ngIf=\"(dataSaver && loading) || delayed; else loadingContent\">\n  <img [ngClass]=\"classes\" [ngStyle]=\"style\" [src]=\"placeholder\" />\n  <button [ngClass]=\"buttonClassName\" (click)=\"fetchImage()\">\n    Load image\n  </button>\n</div>\n<ng-template #loadingContent>\n  <img *ngIf=\"loading; else otherContent\" [ngClass]=\"placeholderClassName\" [ngStyle]=\"style\" [src]=\"placeholder\" />\n  <ng-template #otherContent>\n    <img [ngStyle]=\"style\" [ngClass]=\"classes\" [src]=\"blob\" />\n  </ng-template>\n</ng-template>`,\n  styles: []\n})\nexport class AngularPimgComponent implements OnChanges {\n  @Input() dataSaver: any;\n  @Input() src: string;\n  @Input() fetchOnDemand: boolean;\n  @Input() placeholder: string;\n  @Input() placeholderClassName: string;\n  @Input() className: string;\n  @Input() style: any = { display: 'block' };\n  @Output() fetched: EventEmitter<null> = new EventEmitter();\n  @Output() error: EventEmitter<any> = new EventEmitter();\n  wrapperClassName = '';\n  buttonClassName = '';\n  blob: SafeUrl = '';\n  delayed: boolean;\n  loading: boolean;\n  classes: string;\n  private isIntersecting = false;\n\n  constructor(private el: ElementRef, private domSanitizer: DomSanitizer, private options: AngularPimgService) {\n    this.insertInput();\n    this.setUp();\n  }\n\n  setFetchOnDemand() {\n    const observer = new IntersectionObserver(entries => {\n      const image = entries[0];\n      if (image.isIntersecting && !this.isIntersecting) {\n        this.fetchImage();\n        this.isIntersecting = true;\n        console.log('Called by intersection API');\n        this.delayed = false;\n        observer.disconnect();\n      }\n    });\n    observer.observe(this.el.nativeElement);\n  }\n\n  fetchImage() {\n    fetch(this.src)\n      .then(res => res.blob())\n      .then(res => {\n        console.log(res);\n        this.blob = this.domSanitizer.bypassSecurityTrustUrl(URL.createObjectURL(res));\n        this.loading = false;\n        this.isIntersecting = false;\n        this.delayed = false;\n        this.fetched.emit();\n      })\n      .catch(err => {\n        this.error.emit(err);\n      });\n  }\n\n  ngOnChanges(changes: SimpleChanges) {\n    const newValues: any = {};\n    const props = ['src', 'fetchOnDemand', 'placeholder', 'placeholderClassName', 'className', 'style'];\n    for (const prop in changes) {\n      if (props.findIndex(val => val === prop) > 0 && !this.isUndefined(changes[prop].currentValue)) {\n        console.log(`${prop} is not undefined. It has changed`);\n        this[prop] = changes[prop].currentValue;\n      } else {\n        if (prop === 'dataSaver' && this.isObject(changes[prop])) {\n          this.buttonClassName = changes[prop].currentValue.buttonClassName;\n          this.placeholderClassName = changes[prop].currentValue.placeholderClassName;\n        }\n      }\n    }\n    this.setUp();\n    // changes.dataSaver ? newValues.dataSaver = changes.dataSaver.currentValue : null;\n    // changes.src ? newValues.src = changes.src.currentValue : null;\n    // changes.fetchOnDemand ? newValues.fetchOnDemand = changes.fetchOnDemand.currentValue : null;\n    // changes.placeholder ? newValues.placeholder = changes.placeholder.currentValue : null;\n    // changes.placeholderClassName ? newValues.placeholderClassName = changes.placeholderClassName.currentValue : null;\n    // changes.class ? newValues.class = changes.class.currentValue : null;\n    // changes.style ? newValues.style = changes.style.currentValue : null;\n  }\n\n  insertInput() {\n    // Called on initialization; Set the default configuration options if option is not present\n    console.log('Config options', this.options);\n    if (this.isUndefined(this.fetchOnDemand)) {\n      this.fetchOnDemand = this.options.fetchOnDemand;\n    }\n    if (this.isUndefined(this.placeholderClassName)) {\n      this.placeholderClassName = this.options.placeholderClassName;\n    }\n    if (this.isUndefined(this.dataSaver)) {\n      this.dataSaver = this.options.dataSaver;\n    }\n    if (this.isUndefined(this.className)) {\n      this.className = this.options.className;\n    }\n    if (this.isObject(this.dataSaver)) {\n      // set buttonClassName and wrapperClassName\n      this.buttonClassName = this.dataSaver.buttonClassName;\n      this.wrapperClassName = this.dataSaver.wrapperClassName;\n    } else {\n      this.buttonClassName = this.options.buttonClassName;\n      this.wrapperClassName = this.options.wrapperClassName;\n    }\n  }\n\n  setUp() {\n    if (this.dataSaver) {\n      this.delayed = true;\n    } else if (this.fetchOnDemand) {\n      this.loading = true;\n      this.setFetchOnDemand();\n    } else {\n      this.fetchImage();\n      console.log('Fetching image, due to config', this.dataSaver);\n    }\n    if (this.src && this.src.includes('cloudinary')) {\n      this.placeholder =\n        this.placeholder || this.src.replace('/upload/', '/upload/c_thumb,w_30/');\n    }\n    this.classes = `${this.className} ${this.placeholderClassName}`;\n  }\n\n  isObject = x => typeof x === 'object';\n  isUndefined = x => typeof x === 'undefined';\n\n}\n","import { NgModule, ModuleWithProviders, Optional, SkipSelf } from '@angular/core';\nimport { AngularPimgComponent } from './angular-pimg.component';\nimport { AngularPimgService } from './angular-pimg.service';\nimport { AngularPimgOptions } from './config-options';\nimport { CommonModule } from '@angular/common';\n\n@NgModule({\n  imports: [\n    CommonModule\n  ],\n  declarations: [AngularPimgComponent],\n  exports: [AngularPimgComponent]\n})\nexport class AngularPimgModule {\n  constructor(@Optional() @SkipSelf() parentModule: AngularPimgModule) {\n    if (parentModule) {\n      throw new Error('The Angular Pimg Module is already loaded. Import it only in your AppModule');\n    }\n  }\n  static forRoot(options?: Partial<AngularPimgOptions>): ModuleWithProviders {\n    return {\n      ngModule: AngularPimgModule,\n      providers: [\n        AngularPimgService,\n        { provide: 'Options', useValue: options }\n      ]\n    };\n  }\n}\n"],"names":["Injectable","Optional","Inject","EventEmitter","Component","ElementRef","DomSanitizer","Input","Output","NgModule","CommonModule","SkipSelf"],"mappings":"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"}
